using System;
using System.Collections.Generic;
using Microsoft.VisualStudio.TestTools.UnitTesting;

using Mbs.Trading.Data;
using Mbs.Trading.Indicators.Abstractions;
using Mbs.Trading.Indicators.GeraldAppel;

namespace Mbs.UnitTests.Trading.Indicators.GeraldAppel
{
    [TestClass]
    public class MovingAverageConvergenceDivergenceBandTests
    {
        #region Test data
        /// <summary>
        /// Input Close test data, length = 252.
        /// Taken from TA-Lib (http://ta-lib.org/) tests, test_data.c, TA_SREF_close_daily_ref_0_PRIV[252].
        /// The same data in TA-Lib (http://ta-lib.org/) tests, test_MACD.xsl, INPUT, A4…A255, 252 entries.
        /// </summary>
        private readonly List<double> input = new List<double>
        {
            91.500000,94.815000,94.375000,95.095000,93.780000,94.625000,92.530000,92.750000,90.315000,92.470000,96.125000,
            97.250000,98.500000,89.875000,91.000000,92.815000,89.155000,89.345000,91.625000,89.875000,88.375000,87.625000,
            84.780000,83.000000,83.500000,81.375000,84.440000,89.250000,86.375000,86.250000,85.250000,87.125000,85.815000,
            88.970000,88.470000,86.875000,86.815000,84.875000,84.190000,83.875000,83.375000,85.500000,89.190000,89.440000,
            91.095000,90.750000,91.440000,89.000000,91.000000,90.500000,89.030000,88.815000,84.280000,83.500000,82.690000,
            84.750000,85.655000,86.190000,88.940000,89.280000,88.625000,88.500000,91.970000,91.500000,93.250000,93.500000,
            93.155000,91.720000,90.000000,89.690000,88.875000,85.190000,83.375000,84.875000,85.940000,97.250000,99.875000,
            104.940000,106.000000,102.500000,102.405000,104.595000,106.125000,106.000000,106.065000,104.625000,108.625000,
            109.315000,110.500000,112.750000,123.000000,119.625000,118.750000,119.250000,117.940000,116.440000,115.190000,
            111.875000,110.595000,118.125000,116.000000,116.000000,112.000000,113.750000,112.940000,116.000000,120.500000,
            116.620000,117.000000,115.250000,114.310000,115.500000,115.870000,120.690000,120.190000,120.750000,124.750000,
            123.370000,122.940000,122.560000,123.120000,122.560000,124.620000,129.250000,131.000000,132.250000,131.000000,
            132.810000,134.000000,137.380000,137.810000,137.880000,137.250000,136.310000,136.250000,134.630000,128.250000,
            129.000000,123.870000,124.810000,123.000000,126.250000,128.380000,125.370000,125.690000,122.250000,119.370000,
            118.500000,123.190000,123.500000,122.190000,119.310000,123.310000,121.120000,123.370000,127.370000,128.500000,
            123.870000,122.940000,121.750000,124.440000,122.000000,122.370000,122.940000,124.000000,123.190000,124.560000,
            127.250000,125.870000,128.860000,132.000000,130.750000,134.750000,135.000000,132.380000,133.310000,131.940000,
            130.000000,125.370000,130.130000,127.120000,125.190000,122.000000,125.000000,123.000000,123.500000,120.060000,
            121.000000,117.750000,119.870000,122.000000,119.190000,116.370000,113.500000,114.250000,110.000000,105.060000,
            107.000000,107.870000,107.000000,107.120000,107.000000,91.000000,93.940000,93.870000,95.500000,93.000000,
            94.940000,98.250000,96.750000,94.810000,94.370000,91.560000,90.250000,93.940000,93.620000,97.000000,95.000000,
            95.870000,94.060000,94.620000,93.750000,98.000000,103.940000,107.870000,106.060000,104.500000,105.000000,
            104.190000,103.060000,103.420000,105.270000,111.870000,116.000000,116.620000,118.280000,113.370000,109.000000,
            109.700000,109.250000,107.000000,109.190000,110.000000,109.200000,110.120000,108.000000,108.620000,109.750000,
            109.810000,109.000000,108.750000,107.870000
        };

        /// <summary>
        /// Output data, MACD.
        /// Taken from TA-Lib (http://ta-lib.org/) tests, test_MACD.xsl, Classic, N37…N255, 252 entries.
        /// </summary>
        private readonly List<double> expected = new List<double>
        {
            // Begins with 33 double.NaN values.
                     double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,
                     double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,
                     double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,
                     double.NaN,         double.NaN,         double.NaN,-2.1834929152886500,-1.8948492804471900,-1.7743467257372600,-1.6645017415544000,-1.7142300104532600,-1.7882993947990400,-1.8510796885765000,
            -1.9190576430907500,-1.7809314519769400,-1.3580584366943200,-0.9913282003709580,-0.5606839616518470,-0.2444164360268670, 0.0611996189331734, 0.1053010908371020, 0.2981976732024380, 0.4060431702327920,
             0.3686452756527810, 0.3179928479829500,-0.0870823343564666,-0.4656787611539670,-0.8216083974066490,-0.9267771050415800,-0.9264189460086380,-0.8729027935354310,-0.6016533544919300,-0.3551570321131980,
            -0.2102364714790070,-0.1042703744410720, 0.2567488796421170, 0.4991799319335970, 0.8230312699746920, 1.0873246969872200, 1.2544796646239600, 1.2566725348279800, 1.1068615637932200, 0.9521451441643340,
             0.7550636741512310, 0.2980902868287100,-0.2081206609234560,-0.4826948147358650,-0.6073589544494380, 0.2041134028057170, 1.0469579744124100, 2.0994207245383100, 2.9846331843288100, 3.3649605168219100,
             3.6170122956490000, 3.9479701019021600, 4.2843276982326600, 4.4890599723009200, 4.6034905577127900, 4.5258109245430400, 4.7324629393012900, 4.8954813219261300, 5.0619432305703400, 5.3141633216098800,
             6.2688752069359000, 6.6761979067561600, 6.8494427808973300, 6.9470056562968700, 6.8397742264099300, 6.5581567331775800, 6.1630643184436600, 5.5188401836128900, 4.8491051471088600, 4.8698072678295300,
             4.6610148294445400, 4.4443140320837100, 3.9047984326462300, 3.5772030378431100, 3.2151587480361900, 3.1389683927967300, 3.4024777339305200, 3.2606405768823000, 3.1426696922788900, 2.8748273218086500,
             2.5572319908498300, 2.3741902701174100, 2.2332408846989300, 2.4818618404571100, 2.6084809728550500, 2.7226300825929900, 3.1001243414179200, 3.2504674291990800, 3.2969132395210900, 3.2654173559896400,
             3.2482007252343700, 3.1530230148108800, 3.2068521816892300, 3.5818254357199600, 3.9743905158213100, 4.3363786496235400, 4.4708550661395600, 4.6696516310323100, 4.8671172971900600, 5.2359907701377000,
             5.4996267871748900, 5.6490894582191100, 5.6515563434165000, 5.5140981327487300, 5.3387779035047900, 5.0113472064788600, 4.1887579457721800, 3.5563731068051500, 2.6111556619528600, 1.9158296790975800,
             1.2048383286657200, 0.8933227312770670, 0.8089920184366410, 0.4935877047475830, 0.2663781973872120,-0.1890865527941370,-0.7735209120211690,-1.2919977357799900,-1.3093570964368700,-1.2833069420063600,
            -1.3527741208200000,-1.6215273336133700,-1.4945217045071600,-1.5526851380620500,-1.4010731827211300,-0.9472339221808710,-0.4907247132426990,-0.4968132280262690,-0.5701097768963020,-0.7159676453625820,
            -0.6074976831027070,-0.7102349185617380,-0.7531175398637090,-0.7326624136488530,-0.6237284838378090,-0.5958887555375440,-0.4579984982591300,-0.1301585702118330, 0.0180938927336314, 0.3725584276027550,
             0.8965114571714140, 1.1970842130195400, 1.7380220221538800, 2.1619701971491500, 2.2604826396992900, 2.3860923010739200, 2.3480247445887700, 2.1366837844413200, 1.5774088580073700, 1.5009694272342500,
             1.1838619595090200, 0.7679645194450020, 0.1788942798570190,-0.0453504295621485,-0.3800680744966770,-0.5980939436106640,-1.0365120012514100,-1.2932040748873000,-1.7388379892756900,-1.8990487428360900,
            -1.8330138774736000,-1.9845476567198100,-2.3056120403831700,-2.7598292977788400,-3.0244174134275400,-3.5362808383554200,-4.2910880135740700,-4.6788020338898200,-4.8598451890216700,-5.0157069750762800,
            -5.0710892065996800,-5.0662623030171500,-6.2810986343639700,-6.9267840947141800,-7.3593093517439600,-7.4842871531006900,-7.6963434116781900,-7.6200189030231900,-7.2093370925040400,-6.9250782712425700,
            -6.7782079324053200,-6.6209937588729400,-6.6465268849216700,-6.6952889992342500,-6.3628343708553800,-6.0553803529419700,-5.4758607622355600,-5.1189623847620300,-4.7116036857755100,-4.4831419850222400,
            -4.2083854732067500,-4.0145633004372700,-3.4779269736185800,-2.5440047577507600,-1.4698035372531600,-0.7558304609401740,-0.3122808374933610, 0.0786743471158928, 0.3194663083098280, 0.4143378869283370,
             0.5126636207527750, 0.7314354792106310, 1.4209982118575700, 2.2745188917164500, 2.9667699213299400, 3.6077441477071100, 3.6771371268036700, 3.3409961602633300, 3.0954042786688900, 2.8318162884889800,
             2.4135428911857700, 2.2330319059346800, 2.1307736479068100, 1.9625567944900100, 1.8817879572604300, 1.6279458431089500, 1.4599732939235000, 1.4018754471950200, 1.3451677274254800, 1.2207936708832200,
             1.0894944109611400, 0.9040092995012690
        };

        /// <summary>
        /// Output data, MACD, Metastock.
        /// Taken from TA-Lib (http://ta-lib.org/) tests, test_MACD.xsl, Classic, N37…N255, 252 entries.
        /// </summary>
        private readonly List<double> expectedM = new List<double>
        {
            // Begins with 33 double.NaN values.
                      double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,
                      double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,
                      double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,          double.NaN,
                      double.NaN,          double.NaN,          double.NaN,-1.21846552993858000,-1.00944831763985000,-0.95337724089652900,-0.90306586284701500,-0.99884905089852800,-1.11429653068144000,-1.21615627569059000,
            -1.32006174210252000,-1.22753172047024000,-0.86422025910656000,-0.55009414469444100,-0.17279892811009700, 0.09991842387057660, 0.36496835959683000, 0.38625797751613800, 0.54865153735815400, 0.63266114398865600,
             0.58134625933200800, 0.51833478585324100, 0.12283574848970600,-0.24800727180787900,-0.59754251470903300,-0.71114224614957800,-0.72458468472552800,-0.68687722435271300,-0.44325236486062600,-0.22121572998028700,
            -0.09327574884332530,-0.00100858649990698, 0.33179781649072000, 0.55448412540658900, 0.85458328938085500, 1.09967219505009000, 1.25412703493819000, 1.25383322365717000, 1.11049659077133000, 0.96205507651868100,
             0.77339481632667200, 0.33998499506702700,-0.14073330809287700,-0.40461482423629000,-0.52766474953138200, 0.22977347513756300, 1.01959932768824000, 2.00900441181970000, 2.84382285958510000, 3.20570585697031000,
             3.44704717277351000, 3.76227250163008000, 4.08254285080021000, 4.27905180576371000, 4.39029263878894000, 4.32036495156864000, 4.51678020178653000, 4.67214791500027000, 4.83061911547080000, 5.06962263179170000,
             5.96925589189136000, 6.35631341386093000, 6.52350386460358000, 6.61906793802321000, 6.52149067644662000, 6.25890378442197000, 5.88828217299286000, 5.28201275656055000, 4.64991078437934000, 4.66535911242761000,
             4.46564507034073000, 4.25838139770860000, 3.74751354437736000, 3.43493416732142000, 3.08977562272882000, 3.01313474128719000, 3.25647808241423000, 3.12017140594820000, 3.00639835325985000, 2.75187230910949000,
             2.45029264341878000, 2.27485983903101000, 2.13908362339200000, 2.36976488308267000, 2.48697816857977000, 2.59315860990534000, 2.94746994753613000, 3.08938819983857000, 3.13396580846319000, 3.10525783789909000,
             3.08975204536669000, 3.00080090547772000, 3.05160406155338000, 3.40446749732540000, 3.77485611435623000, 4.11735703321020000, 4.24657811403553000, 4.43615418505154000, 4.62455163630605000, 4.97415292644646000,
             5.22531772039683000, 5.36926121528585000, 5.37478259947038000, 5.24815748354141000, 5.08505671445243000, 4.77811184671864000, 4.00452268618736000, 3.40748732850003000, 2.51498404607270000, 1.85545976974592000,
             1.18028488507436000, 0.87990042704426200, 0.79357426711382600, 0.49102261336351200, 0.27161737120197000,-0.16194569587355500,-0.71701276828309800,-1.21061786032192000,-1.23334541300883000,-1.21408981541258000,
            -1.28354159137913000,-1.53970820732981000,-1.42379749178858000,-1.48089496991166000,-1.34037779367443000,-0.91481691367907600,-0.48517798150385300,-0.48916611878914300,-0.55654867289334200,-0.69251703348769000,
            -0.58988134037828400,-0.68554786159175800,-0.72530325045295300,-0.70565126337746200,-0.60276131182637000,-0.57583302266127100,-0.44543253380027200,-0.13614403342808100, 0.00506567036562444, 0.34028481118180300,
             0.83552265652274100, 1.12175378253616000, 1.63418327531069000, 2.03744640215744000, 2.13509076361642000, 2.25759387172286000, 2.22576400941463000, 2.03019793506888000, 1.50634438234502000, 1.43451815221448000,
             1.13615644956195000, 0.74403780079381900, 0.18811408794093200,-0.02609721477897150,-0.34422725787622700,-0.55298444761034200,-0.96889871300317100,-1.21451119364700000,-1.63771075562468000,-1.79302716522888000,
            -1.73522313667135000,-1.88100345893044000,-2.18596194839367000,-2.61639348881471000,-2.86913586072158000,-3.35432677220025000,-4.06857195016310000,-4.43887578689707000,-4.61483982592655000,-4.76652460357181000,
            -4.82316335820522000,-4.82243499125593000,-5.96760991909042000,-6.58036809451052000,-6.99337006887133000,-7.11716745793770000,-7.32193502118935000,-7.25506174880759000,-6.87261319372335000,-6.60709611885896000,
            -6.46950348740967000,-6.32153936669931000,-6.34483525891544000,-6.39002225750757000,-6.07691278475367000,-5.78636519297244000,-5.23932554051352000,-4.90027320143690000,-4.51331522632177000,-4.29404472209136000,
            -4.03133528501668000,-3.84467746816027000,-3.33591513814011000,-2.45287171085769000,-1.43623400940974000,-0.75649498404041500,-0.33053960677334300, 0.04558637917908470, 0.28005258886842900, 0.37650105461189300,
             0.47509802393831500, 0.68602503830190600, 1.33914862166439000, 2.14735161708941000, 2.80514351655007000, 3.41527453293985000, 3.48831820608072000, 3.17875521426933000, 2.95210031579708000, 2.70693177332058000,
             2.31496502434855000, 2.14498781144538000, 2.04796211492150000, 1.88863608723673000, 1.81111884198818000, 1.57079582093914000, 1.41067039265374000, 1.35365173274700000, 1.29809222940192000, 1.17905503231607000,
             1.05344766699378000, 0.87683758975543900
        };

        /// <summary>
        /// Output data, Signal.
        /// Taken from TA-Lib (http://ta-lib.org/) tests, test_MACD.xsl, U37…U255, 252 entries.
        /// </summary>
        private readonly List<double> expectedSig = new List<double>
        {
            // Begins with 33 double.NaN values.
                     double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,
                     double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,
                     double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,
                     double.NaN,         double.NaN,         double.NaN,-3.1552099196892100,-2.9031377918408000,-2.6773795786201000,-2.4748040112069600,-2.3226892110562200,-2.2158112478047800,-2.1428649359591300,
            -2.0981034773854500,-2.0346690723037500,-1.8993469451818600,-1.7177431962196800,-1.4863313493061200,-1.2379483666502700,-0.9781187695335780,-0.7614347974594420,-0.5495083033270660,-0.3583980086150950,
            -0.2129893517615200,-0.1067929118126260,-0.1028507963213940,-0.1754163892879080,-0.3046547909116570,-0.4290792537376410,-0.5285471921918410,-0.5974183124605590,-0.5982653208668330,-0.5496436631161060,
            -0.4817622247886860,-0.4062638547191630,-0.2736613078469070,-0.1190930598908060, 0.0693318060822932, 0.2729303842632790, 0.4692402403354150, 0.6267266992339290, 0.7227536721457870, 0.7686319665494960,
             0.7659183080698430, 0.6723527038216170, 0.4962580308726020, 0.3004674617509090, 0.1189021785108390, 0.1359444233698150, 0.3181471335783330, 0.6744018517703280, 1.1364481182820300, 1.5821505979900000,
             1.9891229375218000, 2.3808923703978700, 2.7615794359648300, 3.1070755432320500, 3.4063585461282000, 3.6302490218111700, 3.8506918053091900, 4.0596497086325800, 4.2601084130201300, 4.4709193947380800,
             4.8305105571776400, 5.1996480270933500, 5.5296069778541500, 5.8130867135426900, 6.0184242161161400, 6.1263707195284300, 6.1337094393114700, 6.0107355881717600, 5.7784094999591800, 5.5966890535332500,
             5.4095542087155100, 5.2165061733891500, 4.9541646252405600, 4.6787723077610700, 4.3860495958160900, 4.1366333552122200, 3.9898022309558800, 3.8439699001411600, 3.7037098585687100, 3.5379333512167000,
             3.3417930791433200, 3.1482725173381400, 2.9652661908103000, 2.8685853207396600, 2.8165644511627400, 2.7977775774487900, 2.8582469302426200, 2.9366910300339100, 3.0087354719313400, 3.0600718487430000,
             3.0976976240412800, 3.1087627021952000, 3.1283805980940100, 3.2190695656192000, 3.3701337556596200, 3.5633827344524000, 3.7448772007898400, 3.9298320868383300, 4.1172891289086800, 4.3410294571544800,
             4.5727489231585700, 4.7880170301706700, 4.9607248928198400, 5.0713995408056200, 5.1248752133454500, 5.1021696119721400, 4.9194872787321400, 4.6468644443467500, 4.2397226878679700, 3.7749440861138900,
             3.2609229346242600, 2.7874028939548200, 2.3917207188511800, 2.0120941160304600, 1.6629509323018100, 1.2925434352826200, 0.8793305658218650, 0.4450649055014950, 0.0941805051138218,-0.1813169843102150,
            -0.4156084116121720,-0.6567921960124120,-0.8243380977113630,-0.9700075057814990,-1.0562206411694300,-1.0344232973717200,-0.9256835805459120,-0.8399095100419840,-0.7859495634128470,-0.7719531798027950,
            -0.7390620804627770,-0.7332966480825690,-0.7372608264387970,-0.7363411438808090,-0.7138186118722090,-0.6902326406052760,-0.6437858121360470,-0.5410603637512040,-0.4292295124542370,-0.2688719244428390,
            -0.0357952481199881, 0.2107806441079170, 0.5162289197171100, 0.8453771752035180, 1.1283982681026700, 1.3799370746969200, 1.5735546086752900, 1.6861804438285000, 1.6644261266642700, 1.6317347867782700,
             1.5421602213244200, 1.3873210809485300, 1.1456357207302300, 0.9074384906717550, 0.6499371776380690, 0.4003309533883220, 0.1129623624603760,-0.1682709250091590,-0.4823843378624660,-0.7657172188571900,
            -0.9791765505804730,-1.1802507718083400,-1.4053230255233100,-1.6762242799744100,-1.9458629066650400,-2.2639464930031200,-2.6693747971173100,-3.0712602444718100,-3.4289772333817800,-3.7463231817206800,
            -4.0112763866964800,-4.2222735699606200,-4.6340385828412900,-5.0925876852158700,-5.5459320185214900,-5.9336030454373300,-6.2861511186855000,-6.5529246755530400,-6.6842071589432400,-6.7323813814031100,
            -6.7415466916035500,-6.7174361050574300,-6.7032542610302800,-6.7016612086710700,-6.6338958411079400,-6.5181927434747400,-6.3097263472269000,-6.0715735547339300,-5.7995795809422500,-5.5362920617582500,
            -5.2707107440479500,-5.0194812553258100,-4.7111703989843700,-4.2777372707376400,-3.7161505240407500,-3.1240865114206300,-2.5617253766351800,-2.0336454318849600,-1.5630230838460100,-1.1675508896911400,
            -0.8315079876023550,-0.5189192942397580,-0.1309357930202930, 0.3501551439270560, 0.8734780994076330, 1.4203313090675300, 1.8716924726147600, 2.1655532101444700, 2.3515234238493600, 2.4475819967772800,
             2.4407741756589800, 2.3992257217141200, 2.3455353069526600, 2.2689396044601300, 2.1915092750201900, 2.0787965886379400, 1.9550319296950500, 1.8444006331950500, 1.7445540520411300, 1.6398019758095500,
             1.5297404628398700, 1.4045942301721500
        };

        /// <summary>
        /// Output data, Signal, Metastock.
        /// Taken from TA-Lib (http://ta-lib.org/) tests, test_MACD.xsl, Metastock, S37…S255, 252 entries.
        /// </summary>
        private readonly List<double> expectedSigM = new List<double>
        {
            // Begins with 33 double.NaN values.
                     double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,
                     double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,
                     double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,         double.NaN,
                     double.NaN,         double.NaN,         double.NaN,-1.7119209074082100,-1.5714263894545400,-1.4478165597429400,-1.3388664203637500,-1.2708629464707100,-1.2395496633128600,-1.2348709857884000,
            -1.2519091370512300,-1.2470336537350300,-1.1704709748093400,-1.0463956087863600,-0.8716762726511050,-0.6773573333467690,-0.4688921947580490,-0.2978621603032120,-0.1285594207709390, 0.0236846921809804,
             0.1352170056111860, 0.2118405616595970, 0.1940395990256190, 0.1056302248589190,-0.0350043230546712,-0.1702319076736530,-0.2811024630840280,-0.3622574153377650,-0.3784564052423370,-0.3470082701899270,
            -0.2962617659206070,-0.2372111300364670,-0.1234093407310290, 0.0121693524964942, 0.1806521398733660, 0.3644561509087110, 0.5423903277146080, 0.6846789069031200, 0.7698424436767620, 0.8082849702451460,
             0.8013069394614510, 0.7090425505825670, 0.5390873788474780, 0.3503469382307240, 0.1747446006783030, 0.1857503755701550, 0.3525201659937720, 0.6838170151589580, 1.1158181840441900, 1.5337957186294100,
             1.9164460094582300, 2.2856113078926000, 2.6449976164741200, 2.9718084543320400, 3.2555052912234200, 3.4684772232924600, 3.6781378189912800, 3.8769398381930800, 4.0676756936486200, 4.2680650812772400,
             4.6083032434000600, 4.9579052774922400, 5.2710249949145100, 5.5406335835362500, 5.7368050021183200, 5.8412247585790500, 5.8506362414618100, 5.7369115444815600, 5.5195113924611200, 5.3486809364544200,
             5.1720737632316800, 4.9893352901270600, 4.7409709409771200, 4.4797635862459800, 4.2017659935425500, 3.9640397430914800, 3.8225274109560300, 3.6820562099544600, 3.5469246386155400, 3.3879141727143300,
             3.2003898668552200, 3.0152838612903800, 2.8400438137107000, 2.7459880275850900, 2.6941860557840300, 2.6739805666082900, 2.7286784427938600, 2.8008203942028000, 2.8674494770548800, 2.9150111492237200,
             2.9499593284523200, 2.9601276438574000, 2.9784229273965900, 3.0636318413823500, 3.2058766959771300, 3.3881727634237400, 3.5598538335461000, 3.7351139038471900, 3.9130014503389600, 4.1252317455604600,
             4.3452489405277300, 4.5500513954793600, 4.7149976362775600, 4.8216296057303300, 4.8743150274747500, 4.8550743913235300, 4.6849640502963000, 4.4294687059370400, 4.0465717739641700, 3.6083493731205200,
             3.1227364755112900, 2.6741692658178800, 2.2980502660770700, 1.9366447355343600, 1.6036392626678800, 1.2505222709596000, 0.8570152631110560, 0.4434886384244620, 0.1081218281378030,-0.1563205005722740,
            -0.3817647187336460,-0.6133534164528780,-0.7754422315200180,-0.9165327791983460,-1.0013017820935600,-0.9840048084106670,-0.8842394430293040,-0.8052247781812720,-0.7554895571236860,-0.7428950523964870,
            -0.7122923099928460,-0.7069434203126280,-0.7106153863406930,-0.7096225617480470,-0.6882503117637120,-0.6657668539432240,-0.6216999899146330,-0.5245887986173230,-0.4186579048207340,-0.2668693616202260,
            -0.0463909579916328, 0.1872379901139260, 0.4766270471532790, 0.7887909181541120, 1.0580508872465700, 1.2979594841418300, 1.4835203891963900, 1.5928558983708900, 1.5755535951657200, 1.5473465065754700,
             1.4651084951727700, 1.3208943562969800, 1.0943383026257700, 0.8702511991448200, 0.6273555077406100, 0.3912875166704200, 0.1192502707357020,-0.1475020221408380,-0.4455437688376070,-0.7150404481158610,
            -0.9190769858269590,-1.1114622804476500,-1.3263622140368600,-1.5843684689924300,-1.8413219473382600,-2.1439229123106600,-2.5288527198811500,-2.9108573332843300,-3.2516538318127800,-3.5546279861645800,
            -3.8083350605727100,-4.0111550467093600,-4.4024460211855700,-4.8380304358505600,-5.2690983624547100,-5.6387121815513100,-5.9753567494789200,-6.2312977493446500,-6.3595608382203900,-6.4090678943481100,
            -6.4211550129604200,-6.4012318837082000,-6.3899525587496500,-6.3899664985012300,-6.3273557557517200,-6.2191576431958600,-6.0231912226594000,-5.7986076184149000,-5.5415491399962700,-5.2920482564152900,
            -5.0399056621355700,-4.8008600233405100,-4.5078710463004300,-4.0968711792118800,-3.5647437452514500,-3.0030939930092500,-2.4685831157620700,-1.9657492167738400,-1.5165888556453800,-1.1379708735939300,
            -0.8153570940874790,-0.5150806676096020,-0.1442348097548030, 0.3140824756140400, 0.8122946838012470, 1.3328906536289700, 1.7639761641193200, 2.0469319741493200, 2.2279656424788700, 2.3237588686472100,
             2.3220000997874800, 2.2865976421190600, 2.2388705366795500, 2.1688236467909900, 2.0972826858304200, 1.9919853128521700, 1.8757223288124800, 1.7713082095993900, 1.6766650135598900, 1.5771430173111300,
             1.4724039472476600, 1.3532906757492100
        };
        #endregion

        [TestMethod]
        public void MovingAverageConvergenceDivergenceBand_Name_HasCorrectValue()
        {
            var target = new MovingAverageConvergenceDivergenceBand(new MovingAverageConvergenceDivergence());
            Assert.AreEqual("MACD", target.Name);
        }

        [TestMethod]
        public void MovingAverageConvergenceDivergenceBand_Moniker_HasCorrectValue()
        {
            var target = new MovingAverageConvergenceDivergenceBand(new MovingAverageConvergenceDivergence());
            Assert.AreEqual("MACD(12,26,9)", target.Moniker);
        }

        [TestMethod]
        public void MovingAverageConvergenceDivergenceBand_Parent_HasCorrectValue()
        {
            var parent = new MovingAverageConvergenceDivergence();
            var target = new MovingAverageConvergenceDivergenceBand(parent);
            Assert.AreEqual(parent, target.Parent);
        }

        [TestMethod]
        public void MovingAverageConvergenceDivergenceBand_Description_HasCorrectValue()
        {
            var target = new MovingAverageConvergenceDivergenceBand(new MovingAverageConvergenceDivergence());
            Assert.AreEqual("Moving Average Convergence/Divergence band", target.Description);
        }

        [TestMethod]
        public void MovingAverageConvergenceDivergenceBand_IsPrimed_HasCorrectValue()
        {
            var parent = new MovingAverageConvergenceDivergence();
            var target = new MovingAverageConvergenceDivergenceBand(parent);
            Assert.IsFalse(target.IsPrimed);
            var scalar = new Scalar(DateTime.Now, 1d);
            for (int i = 1; i <= 33; ++i)
            {
                scalar.Value = i;
                parent.Update(scalar);
                target.Update(scalar);
                Assert.IsFalse(target.IsPrimed);
            }

            scalar.Value = 34.0;
            parent.Update(scalar);
            target.Update(scalar);
            Assert.IsTrue(target.IsPrimed);

            scalar.Value = 35.0;
            parent.Update(scalar);
            target.Update(scalar);
            Assert.IsTrue(target.IsPrimed);
        }

        [TestMethod]
        public void MovingAverageConvergenceDivergenceBand_TaLibTest_Update_ReturnsCorrectValues()
        {
            double u;
            const int digits = 9;
            int count = input.Count;
            var parent = new MovingAverageConvergenceDivergence();
            var target = new MovingAverageConvergenceDivergenceBand(parent);
            for (int i = 0; i < 33; ++i)
            {
                DateTime dateTime = DateTime.Now;
                parent.Update(input[i], dateTime);
                target.Update(input[i], dateTime);
                u = target.Value.FirstValue;
                Assert.IsFalse(target.IsPrimed);
                Assert.IsTrue(double.IsNaN(u));
                Assert.IsTrue(double.IsNaN(target.Value.SecondValue));
                Assert.AreEqual(dateTime, target.Value.Time);
            }

            for (int i = 33; i < count; ++i)
            {
                DateTime dateTime = DateTime.Now;
                parent.Update(input[i], dateTime);
                target.Update(input[i], dateTime);
                u = target.Value.FirstValue;
                Assert.IsFalse(double.IsNaN(u));
                double d = Math.Round(u, digits);
                u = Math.Round(expected[i], digits);
                Assert.AreEqual(u, d);
                u = target.Value.SecondValue;
                Assert.IsFalse(double.IsNaN(u));
                d = Math.Round(u, digits);
                u = Math.Round(expectedSig[i], digits);
                Assert.AreEqual(u, d);
                Assert.AreEqual(dateTime, target.Value.Time);
            }
        }

        [TestMethod]
        public void MovingAverageConvergenceDivergenceBand_TaLibTest_Update_MetastockMode_ReturnsCorrectValues()
        {
            double u;
            const int digits = 9;
            int count = input.Count;
            // The test_MACD.xls uses non-standard alphas for the Metastock data.
            var parent = new MovingAverageConvergenceDivergence(0.075, 0.15, 0.2, false);
            var target = new MovingAverageConvergenceDivergenceBand(parent);
            for (int i = 0; i < 33; ++i)
            {
                DateTime dateTime = DateTime.Now;
                parent.Update(input[i], dateTime);
                target.Update(input[i], dateTime);
                u = target.Value.FirstValue;
                Assert.IsFalse(target.IsPrimed);
                Assert.IsTrue(double.IsNaN(u));
                Assert.IsTrue(double.IsNaN(target.Value.SecondValue));
                Assert.AreEqual(dateTime, target.Value.Time);
            }

            for (int i = 33; i < count; ++i)
            {
                DateTime dateTime = DateTime.Now;
                parent.Update(input[i], dateTime);
                target.Update(input[i], dateTime);
                u = target.Value.FirstValue;
                Assert.IsFalse(double.IsNaN(u));
                double d = Math.Round(u, digits);
                u = Math.Round(expectedM[i], digits);
                Assert.AreEqual(u, d);
                u = target.Value.SecondValue;
                Assert.IsFalse(double.IsNaN(u));
                d = Math.Round(u, digits);
                u = Math.Round(expectedSigM[i], digits);
                Assert.AreEqual(u, d);
                Assert.AreEqual(dateTime, target.Value.Time);
            }
        }

        [TestMethod]
        public void MovingAverageConvergenceDivergenceBand_Value_ReturnsCorrectValues()
        {
            const int digits = 9;
            int count = input.Count;
            var parent = new MovingAverageConvergenceDivergence();
            var target = new MovingAverageConvergenceDivergenceBand(parent);
            for (int i = 0; i < 33; ++i)
            {
                DateTime dateTime = DateTime.Now;
                parent.Update(input[i], dateTime);
                target.Update(input[i], dateTime);
                Assert.IsFalse(target.IsPrimed);
                Assert.IsTrue(double.IsNaN(target.Value.FirstValue));
                Assert.IsTrue(double.IsNaN(target.Value.SecondValue));
                Assert.AreEqual(dateTime, target.Value.Time);
            }

            for (int i = 33; i < count; ++i)
            {
                DateTime dateTime = DateTime.Now;
                parent.Update(input[i], dateTime);
                Band band = target.Update(input[i], dateTime);
                Assert.IsFalse(double.IsNaN(band.FirstValue));
                Assert.AreEqual(band.FirstValue, target.Value.FirstValue);
                double d = Math.Round(target.Value.FirstValue, digits);
                double u = Math.Round(parent.Value, digits);
                Assert.AreEqual(u, d);
                Assert.IsFalse(double.IsNaN(band.SecondValue));
                Assert.AreEqual(band.SecondValue, target.Value.SecondValue);
                d = Math.Round(target.Value.SecondValue, digits);
                u = Math.Round(parent.Signal, digits);
                Assert.AreEqual(u, d);
                Assert.AreEqual(dateTime, target.Value.Time);
            }
        }

        [TestMethod]
        public void MovingAverageConvergenceDivergenceBand_Update_ReturnsCorrectValues()
        {
            const int digits = 9;
            int count = input.Count;
            var parent = new MovingAverageConvergenceDivergence();
            var target = new MovingAverageConvergenceDivergenceBand(parent);
            var scalar = new Scalar(DateTime.Now, 1d);
            for (int i = 0; i < 33; ++i)
            {
                DateTime dateTime = DateTime.Now;
                scalar.Value = input[i];
                scalar.Time = dateTime;
                parent.Update(scalar);
                Band band = target.Update(scalar);
                Assert.IsFalse(target.IsPrimed);
                Assert.IsTrue(double.IsNaN(band.FirstValue));
                Assert.IsTrue(double.IsNaN(band.SecondValue));
                Assert.AreEqual(dateTime, band.Time);
            }

            for (int i = 33; i < count; ++i)
            {
                DateTime dateTime = DateTime.Now;
                scalar.Value = input[i];
                scalar.Time = dateTime;
                parent.Update(scalar);
                Band band = target.Update(scalar);
                Assert.IsFalse(double.IsNaN(band.FirstValue));
                Assert.AreEqual(band.FirstValue, target.Value.FirstValue);
                double d = Math.Round(band.FirstValue, digits);
                double u = Math.Round(expected[i], digits);
                Assert.AreEqual(u, d);
                Assert.IsFalse(double.IsNaN(band.SecondValue));
                Assert.AreEqual(band.SecondValue, target.Value.SecondValue);
                d = Math.Round(band.SecondValue, digits);
                u = Math.Round(expectedSig[i], digits);
                Assert.AreEqual(u, d);
                Assert.AreEqual(dateTime, target.Value.Time);
            }
        }

        [TestMethod]
        public void MovingAverageConvergenceDivergenceBand_Constructor_CreatesAnInstance()
        {
            var parent = new MovingAverageConvergenceDivergence();
            var target = new MovingAverageConvergenceDivergenceBand(parent);
            Assert.IsNotNull(target);
         }
    }
}
